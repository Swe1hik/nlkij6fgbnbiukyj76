<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ReqSNGLove - Abyss Interface</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Roboto:wght@400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        :root {
          --background-color: #030409;
          --text-primary: #dfe4ea; 
          --text-secondary: #9090a0; 
          --accent-color: #00d9ff; 

          --primary-glow: rgba(0, 217, 255, 0.65);
          --secondary-glow: rgba(223, 228, 234, 0.7);

          --card-background: rgba(15, 15, 25, 0.8); 
          --input-background: rgba(0, 0, 0, 0.6);
          --nav-background: rgba(5, 5, 10, 0.75); 
          --footer-background: rgba(5, 5, 10, 0.85);
          --modal-background: rgba(10, 10, 18, 0.9); 

          --card-border: rgba(0, 217, 255, 0.15);
          --input-border: rgba(0, 217, 255, 0.2); 
          --nav-border: rgba(0, 217, 255, 0.1);
          --footer-border: rgba(0, 217, 255, 0.1);

          --button-bg: transparent;
          --button-border: var(--accent-color);
          --button-text: var(--accent-color);
          --button-hover-bg: var(--accent-color);
          --button-hover-text: #030409;
          --button-glow-hover: 0 0 18px 2px var(--primary-glow); 

           --success-bg: rgba(40, 167, 69, 0.85);
           --error-bg: rgba(220, 53, 69, 0.85);
           --info-bg: rgba(0, 123, 255, 0.85);
           --success-border: rgba(40, 167, 69, 0.9);
           --error-border: rgba(220, 53, 69, 0.9);
           --info-border: rgba(0, 123, 255, 0.9);

           --scrollbar-track-bg: rgba(0, 217, 255, 0.05);
           --scrollbar-thumb-bg: rgba(0, 217, 255, 0.6);
           --scrollbar-thumb-hover-bg: rgba(0, 217, 255, 0.9);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html {
        -ms-overflow-style: none; 
        scrollbar-width: none; 
        }

        body {
        -ms-overflow-style: none; 
        scrollbar-width: none; 
          font-family: 'Poppins', sans-serif;
          background: radial-gradient(ellipse at bottom, #0b0c14 0%, var(--background-color) 70%);
          color: var(--text-primary);
          text-align: center;
          overflow-x: hidden;
          line-height: 1.7;
          font-weight: 400;
          display: flex;
          flex-direction: column;
          min-height: 130vh;
        }

        #particles-js {
          position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        }

        .nav {
          position: fixed; top: 0; width: 100%;
          backdrop-filter: blur(12px);
          padding: 15px 0;
          z-index: 1000;
          display: flex; justify-content: center; flex-wrap: wrap;
          gap: 20px; 
          border-bottom: 1px solid var(--nav-border);
          box-shadow: 0 2px 15px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.03); 
        }

        .nav a {
          color: var(--text-secondary); text-decoration: none; font-size: 1em;
          padding: 8px 18px; border: 2px solid transparent; border-radius: 20px;
          transition: all 0.3s ease-in-out; display: flex; align-items: center;
          gap: 8px; font-weight: 500;
        }
        .nav a:hover {
          color: var(--text-primary); background: rgba(255, 255, 255, 0.1);
          text-shadow: 0 0 8px var(--secondary-glow);
        }
        .nav a.active {
          border-color: var(--accent-color); color: var(--accent-color);
          background: rgba(0, 217, 255, 0.1);
          text-shadow: 0 0 10px var(--primary-glow);
          box-shadow: 0 0 12px rgba(0, 217, 255, 0.3);
        }

        .nav-user-details {
            display: flex; align-items: center; gap: 8px; padding: 8px 15px;
            margin-left: 15px; color: var(--text-primary); border: 2px solid transparent;
            border-radius: 20px; background-color: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease-in-out; white-space: nowrap;
        }
        .nav-user-icon { color: var(--accent-color); font-size: 1em; }
        .nav-username-text { font-weight: 600; color: #fff; }
        .nav-userid-text { font-size: 0.85em; color: var(--text-secondary); opacity: 0.8; }
        .nav-user-details:hover { background-color: rgba(255, 255, 255, 0.1); box-shadow: 0 0 8px var(--secondary-glow); }

        .content {
          padding: 120px 20px 80px;
          flex: 1; display: flex; justify-content: center; align-items: flex-start;
          width: 100%;
        }
        .tab-content {
          display: none; width: 100%; max-width: 1100px; margin: 0 auto;
          animation: fadeIn 0.6s ease-out;
        }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(25px) scale(0.97); } to { opacity: 1; transform: translateY(0) scale(1); } }

        h1 {
          font-size: 3.8em; letter-spacing: 3px; margin: 40px 0 15px;
          font-family: 'Share Tech Mono', monospace; font-weight: 700; color: #fff;
          text-shadow: 0 0 25px var(--primary-glow), 0 0 8px rgba(255, 255, 255, 0.5);
        }
         h2 {
            color: var(--accent-color);
            margin-bottom: 25px; font-weight: 600; font-size: 1.8em;
            border-bottom: 1px solid var(--nav-border);
            padding-bottom: 12px;
            text-shadow: 0 0 8px rgba(0, 217, 255, 0.2);
         }
         h3 {
             color: #fff;
             font-weight: 600;
             margin-bottom: 15px;
         }

        .sub {
          margin-top: 0; font-size: 1.3em; color: var(--text-secondary);
          font-weight: 300; margin-bottom: 40px;
        }

        .buttons { margin-top: 30px; display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
        .btn, .footer .bottom-btn, .delete-post-button {
          padding: 12px 35px; background: var(--button-bg); border: 2px solid var(--button-border);
          color: var(--button-text); text-decoration: none; font-size: 1em; font-weight: 600;
          transition: all 0.3s ease-in-out; border-radius: 30px;
          box-shadow: 0 4px 15px rgba(0, 217, 255, 0.1), inset 0 0 0 0 rgba(0, 217, 255, 0.4);
          display: inline-flex; align-items: center; gap: 8px; cursor: pointer; text-align: center;
        }
        .btn:hover, .footer .bottom-btn:hover {
          background: var(--button-hover-bg); color: var(--button-hover-text);
          box-shadow: var(--button-glow-hover), inset 0 0 10px 2px rgba(0, 0, 0, 0.2);
          transform: translateY(-3px) scale(1.03);
        }
         .delete-post-button {
             padding: 5px 10px; font-size: 0.85em; border-color: #a13d4a;
             color: #dc3545; background: transparent; box-shadow: none; border-radius: 5px;
         }
          .delete-post-button:hover {
             background: rgba(220, 53, 69, 0.15); color: #ff4d62; transform: none;
             box-shadow: 0 0 10px rgba(220, 53, 69, 0.3);
          }
         .btn:disabled, .delete-post-button:disabled {
             cursor: not-allowed; opacity: 0.5; background: transparent !important;
             color: var(--text-secondary) !important; border-color: var(--text-secondary) !important;
             transform: none; box-shadow: none;
         }
         .btn i.fa-spinner { margin-right: 8px; }

        .feature-list { list-style: none; padding: 0; margin: 40px auto; max-width: 750px; }
        .feature-list li {
          margin: 20px 0; padding: 25px; display: flex; justify-content: space-between;
          align-items: center; transition: all 0.3s ease-in-out;
          background: var(--card-background); border-radius: 12px; border: 1px solid var(--card-border);
          box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 15px rgba(0, 217, 255, 0.05);
        }
        .feature-list li:hover {
          background: rgba(25, 25, 40, 0.85);
          transform: translateY(-4px) scale(1.02);
          box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4), 0 0 25px rgba(0, 217, 255, 0.15);
          border-color: rgba(0, 217, 255, 0.3);
        }
        .feature-list .item-info { flex-grow: 1; margin-right: 20px; text-align: left; }
        .feature-list .item-title { font-weight: 600; font-size: 1.1em; color: #fff; }
        .feature-list .item-desc { font-size: 0.9em; color: var(--text-secondary); }
        .feature-list .btn { padding: 8px 20px; font-size: 0.9em; box-shadow: none; white-space: nowrap; }
        .feature-list .btn:hover { box-shadow: 0 0 12px 1px var(--primary-glow); }

        #forum-content-wrapper {
             text-align: left; width: 100%; background-color: transparent;
             border-radius: 0; box-shadow: none; border: none; padding: 0;
             display: flex; gap: 30px; align-items: flex-start;
        }
        #forum-categories {
            flex: 0 0 220px; background: rgba(10, 10, 15, 0.6);
            padding: 20px; border-radius: 8px; border: 1px solid var(--nav-border);
            align-self: stretch; backdrop-filter: blur(3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        #forum-categories h3 {
            margin-bottom: 15px; color: var(--accent-color); border-bottom: 1px solid var(--accent-color);
            padding-bottom: 8px; font-size: 1.2em; margin-top: 0;
        }
        #forum-categories ul { list-style: none; padding: 0; margin: 0; }
        #forum-categories li a {
            display: block; padding: 10px 12px; color: var(--text-secondary); text-decoration: none;
            border-radius: 4px; transition: background-color 0.2s ease, color 0.2s ease, border-left-color 0.3s ease, padding-left 0.3s ease;
            font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: pointer;
            border-left: 3px solid transparent;
        }
         #forum-categories li a:hover { background-color: rgba(0, 217, 255, 0.08); color: var(--text-primary); }
         #forum-categories li a.active-category {
            background-color: rgba(0, 217, 255, 0.15); color: var(--accent-color);
            border-left-color: var(--accent-color);
             padding-left: 9px;
        }
                #forum-main-area {
            flex: 1;
            min-height: 450px;
            display: flex;
            flex-direction: column;

            background-color: rgba(10, 10, 18, 0.85);
            border-radius: 10px;
            border: 1px solid var(--card-border);
            padding: 25px 30px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4),
                        inset 0 0 15px rgba(0, 217, 255, 0.05);
            backdrop-filter: blur(5px);
            transition: background-color 0.4s ease;
        }
        .forum-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--card-border);
            padding-bottom: 15px;
        }
        .forum-header h2 { margin: 0; border: none; padding: 0; color: #fff; font-weight: 600; font-size: 1.6em; }
        .forum-header .btn { padding: 8px 20px; font-size: 0.9em; }

        #forum-posts-list { flex-grow: 1; }
         #forum-posts-list ul { list-style: none; padding: 0; margin: 0; }
         #forum-posts-list li {
            background: var(--card-background); padding: 18px 25px;
            margin-bottom: 18px; border-radius: 10px;
            border: 1px solid var(--card-border); display: flex; justify-content: space-between;
            align-items: center; gap: 15px; overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        #forum-posts-list li:hover {
            background: rgba(25, 25, 40, 0.9); border-color: rgba(0, 217, 255, 0.4);
            transform: scale(1.01);
             box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 15px rgba(0, 217, 255, 0.1);
        }
         #forum-posts-list .post-info { flex-grow: 1; }
        #forum-posts-list .post-title a {
            font-size: 1.15em; font-weight: 600; color: #fff; text-decoration: none;
            transition: color 0.3s ease; display: block; margin-bottom: 3px; cursor: pointer;
        }
        #forum-posts-list .post-title a:hover { color: var(--accent-color); }
        #forum-posts-list .post-meta { font-size: 0.85em; color: var(--text-secondary); margin-top: 0; }
        #forum-posts-list .post-actions { flex-shrink: 0; }
        #forum-posts-list .post-actions button { }
        #forum-posts-list .post-actions button i { margin-right: 0; }

        #forum-post-view {
            display: none; flex-grow: 1; padding: 30px;
            background: rgba(10, 10, 18, 0.8);
            border-radius: 10px; border: 1px solid var(--card-border);
             backdrop-filter: blur(4px);
             box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
         #forum-post-view h3 { font-size: 2em; color: #fff; margin-bottom: 15px; margin-top: 20px; }
          #forum-post-view .post-meta {
             font-size: 0.9em; color: var(--text-secondary); margin-bottom: 30px;
             padding-bottom: 20px; border-bottom: 1px solid var(--nav-border);
          }
           #forum-post-view .post-content-full {
              line-height: 1.9;
              color: var(--text-primary); white-space: pre-wrap; font-size: 1.05em; word-wrap: break-word;
              background: rgba(0,0,0,0.15);
              padding: 15px;
              border-radius: 5px;
           }
            #forum-post-view .back-link {
                display: inline-flex; align-items: center;
                margin-bottom: 25px; color: var(--accent-color); text-decoration: none;
                font-weight: 500; font-size: 0.95em; transition: color 0.2s ease; cursor: pointer;
            }
             #forum-post-view .back-link:hover { color: #fff; text-decoration: underline; }
             #forum-post-view .back-link i { margin-right: 6px; }

         #forum-prompt { text-align: center; color: var(--text-secondary); margin-top: 50px; font-size: 1.1em; }

        #cabinet-content { max-width: 500px; margin: 30px auto; padding: 0; background-color: transparent; box-shadow: none; border-radius: 15px; }
        .profile-card, .auth-card {
            background: var(--card-background); border: 1px solid var(--card-border);
            padding: 40px;
            border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 217, 255, 0.08);
            animation: fadeIn 0.5s ease-out; backdrop-filter: blur(5px);
        }
        .profile-card { display: none; flex-direction: column; align-items: center; text-align: left; }
        .profile-card.active { display: flex; }
        .auth-card { position: relative; overflow: hidden; min-height: 420px; display: none; }
        .auth-card.active { display: block; }

        .profile-header { display: flex; align-items: center; width: 100%; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid var(--card-border); }
        .profile-avatar { width: 80px; height: 80px; border-radius: 50%; background: var(--accent-color); margin-right: 20px; display: flex; justify-content: center; align-items: center; font-size: 2.5em; color: var(--background-color); box-shadow: 0 0 20px var(--primary-glow); flex-shrink: 0; }
        .profile-avatar .fa-user { opacity: 0.9; }
        .profile-name { flex-grow: 1; overflow: hidden;}
        .profile-name h3 { font-size: 1.8em; font-weight: 600; color: #fff; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
         .profile-name p { font-size: 1em; color: var(--text-secondary); margin: 5px 0 0 0; word-break: break-all; }
        .profile-details { width: 100%; margin-bottom: 30px; }
        .profile-details .detail-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px dashed rgba(255, 255, 255, 0.1); }
         .profile-details .detail-item:last-child { border-bottom: none; }
        .profile-details .detail-item strong { color: var(--text-primary); font-weight: 500; }
        .profile-details .detail-item span { color: var(--text-secondary); }
        .profile-actions { width: 100%; text-align: center; }
        .profile-actions .btn { background: #a13d4a; border-color: #a13d4a; color: #fff; box-shadow: 0 4px 15px rgba(161, 61, 74, 0.3); }
        .profile-actions .btn:hover { background: #dc3545; border-color: #dc3545; color: #fff; box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4); }

        .auth-form { display: none; animation: slideIn 0.4s ease-out forwards; }
        .auth-form.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(30px); } to { opacity: 1; transform: translateX(0); } }
        .auth-card h2 { font-size: 1.8em; margin-bottom: 30px; color: #fff; font-weight: 600; }
        .input-group { position: relative; margin-bottom: 25px; }
        .input-group i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); font-size: 0.9em; transition: color 0.3s ease; z-index: 2; }
        .input-group input {
          width: 100%; padding: 14px 14px 14px 45px; border: 1px solid var(--input-border);
          background-color: var(--input-background); color: var(--text-primary);
          border-radius: 8px; font-size: 1em; transition: all 0.3s ease;
        }
        .input-group input:focus {
          outline: none; border-color: var(--accent-color);
          box-shadow: inset 0 0 8px rgba(0, 217, 255, 0.2), 0 0 10px rgba(0, 217, 255, 0.1);
           background-color: rgba(0, 0, 10, 0.5);
        }
         .input-group input:focus + i { color: var(--accent-color); }
         .message-placeholder { min-height: 20px; margin-bottom: 15px; }
          .message-placeholder .message { margin-bottom: 0; }
        .auth-card button[type="submit"] {
          width: 100%; padding: 14px 20px; background-color: var(--accent-color);
          color: var(--button-hover-text); border: none; border-radius: 8px; cursor: pointer;
          transition: all 0.3s ease; font-size: 1.1em; font-weight: 600; margin-top: 10px;
          box-shadow: 0 4px 15px rgba(0, 217, 255, 0.2);
        }
        .auth-card button[type="submit"]:hover {
          background-color: #00bfff;
           box-shadow: var(--button-glow-hover);
           transform: translateY(-2px);
        }
         .auth-card button[type="submit"]:disabled {
             background-color: var(--text-secondary) !important; cursor: not-allowed;
             transform: none; box-shadow: none; color: #ccc !important;
         }
        .auth-toggle { margin-top: 30px; font-size: 0.95em; color: var(--text-secondary); }
        .auth-toggle a { color: var(--accent-color); text-decoration: none; font-weight: 600; transition: all 0.3s ease; cursor: pointer; }
        .auth-toggle a:hover { color: #fff; text-shadow: 0 0 8px var(--primary-glow); }

        .footer {
          backdrop-filter: blur(10px); padding: 40px 20px;
          color: var(--text-secondary); text-align: center; border-top: 1px solid var(--footer-border); margin-top: auto;
          box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.03);
        }
        .footer-content { display: flex; flex-direction: column; align-items: center; gap: 25px; }
        .footer-links { display: flex; justify-content: center; gap: 25px; flex-wrap: wrap; }
        .footer-links a { color: var(--text-secondary); text-decoration: none; transition: color 0.3s ease; font-size: 0.95em; }
        .footer-links a:hover { color: var(--accent-color); }
        .footer p { font-size: 0.9em; color: #777; }

        .message-container { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); z-index: 1100; width: 90%; max-width: 600px; pointer-events: none; }
        .message {
            padding: 15px 20px; margin-bottom: 15px; border-radius: 8px; text-align: center; font-weight: 500;
            border: 1px solid transparent; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3); backdrop-filter: blur(3px);
             opacity: 0; transform: translateY(-20px); transition: opacity 0.4s ease, transform 0.4s ease; pointer-events: auto;
        }
        .message.show { opacity: 1; transform: translateY(0); }
        .message.success { background-color: var(--success-bg); border-color: var(--success-border); color: #fff; }
        .message.error { background-color: var(--error-bg); border-color: var(--error-border); color: #fff; }
        .message.info { background-color: var(--info-bg); border-color: var(--info-border); color: #fff; }

        .modal {
            display: none; position: fixed; z-index: 1050; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(3, 4, 9, 0.7);
            backdrop-filter: blur(8px); align-items: center; justify-content: center;
        }
        .modal.show { display: flex; animation: fadeInModal 0.4s ease-out forwards; }
        .modal.hide { animation: fadeOutModal 0.4s ease-out forwards; }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOutModal { from { opacity: 1; } to { opacity: 0; } }
        .modal-content {
            background-color: var(--modal-background); padding: 35px 45px; border: 1px solid var(--card-border);
            width: 90%; max-width: 650px; border-radius: 12px; box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
            position: relative; max-height: 85vh; overflow-y: auto;
        }
        .modal.show .modal-content { animation: slideInModal 0.5s cubic-bezier(0.25, 1, 0.5, 1) forwards; }
        .modal.hide .modal-content { animation: slideOutModal 0.4s ease-out forwards; }
        @keyframes slideInModal { from { transform: translateY(-60px) scale(0.95); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
        @keyframes slideOutModal { from { transform: translateY(0) scale(1); opacity: 1; } to { transform: translateY(-60px) scale(0.95); opacity: 0; } }
        .modal-close {
            color: var(--text-secondary); position: absolute; top: 18px; right: 22px;
            font-size: 28px; font-weight: bold; transition: color 0.3s ease, transform 0.3s ease; cursor: pointer; line-height: 1;
        }
        .modal-close:hover, .modal-close:focus { color: var(--accent-color); transform: rotate(90deg); }
        .modal h2 {
            color: var(--accent-color); margin-bottom: 30px; font-weight: 600;
            border-bottom: 1px solid var(--nav-border); padding-bottom: 12px; margin-top: 0;
            text-align: left;
        }
        .modal .input-group { margin-bottom: 20px; }
        .modal .input-group input, .modal .input-group textarea {
            width: 100%; padding: 12px 15px; border: 1px solid var(--input-border);
            background-color: rgba(0,0,0,0.4);
            color: var(--text-primary); border-radius: 8px; font-size: 1em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
        }
         .modal .input-group textarea { min-height: 140px; resize: vertical; }
        .modal .input-group input:focus, .modal .input-group textarea:focus {
          outline: none; border-color: var(--accent-color); background-color: rgba(0, 0, 10, 0.6);
          box-shadow: inset 0 0 8px rgba(0, 217, 255, 0.2), 0 0 10px rgba(0, 217, 255, 0.1);
        }
        .modal button[type="submit"] { width: auto; padding: 12px 30px; margin-top: 10px; float: right; }
         .modal-content::after { content: ""; display: table; clear: both; }

        .loading-indicator { display: none; text-align: center; padding: 30px 0; color: var(--accent-color); font-size: 1.1em; }
        .loading-indicator.show { display: block; }
        .loading-indicator i { font-size: 2.5em; animation: spin 1.5s linear infinite; display: block; margin: 0 auto 10px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #cookie-banner { }

        #custom-scrollbar {
            display: none;
            position: fixed; top: 0; right: 1px; height: 100vh; width: 15px;
            background: rgba(3, 4, 9, 0.3); border-radius: 10px; display: flex;
            flex-direction: column; align-items: center; padding: 8px 0; z-index: 9999;
             pointer-events: none;
        }
        #scrollbar-track {
            width: 6px;
            height: 100%; background: var(--scrollbar-track-bg);
            border-radius: 3px; position: relative; overflow: hidden;
             pointer-events: auto;
        }
        #scrollbar-thumb {
            position: absolute; top: 0; left: 0; width: 100%;
            background: var(--scrollbar-thumb-bg);
            border-radius: 3px; cursor: pointer; transition: background 0.2s ease;
             pointer-events: auto;
        }
        #scrollbar-thumb:hover { background: var(--scrollbar-thumb-hover-bg); }

        @media (max-width: 992px) {
            #forum-content-wrapper { flex-direction: column; }
            #forum-categories { flex: 0 0 auto; width: 100%; margin-bottom: 20px; align-self: auto; max-height: 250px; overflow-y: auto; }
            .nav-userid-text { display: none; }
             .nav-user-details { margin-left: 10px; padding: 8px 12px; }
        }
        @media (max-width: 768px) {
            h1 { font-size: 2.8em; }
            .nav { gap: 10px; flex-wrap: wrap; padding: 10px 0;}
            .nav a { padding: 6px 12px; font-size: 0.9em; }
            .feature-list li { flex-direction: column; align-items: flex-start; gap: 15px; }
            .feature-list .btn { align-self: flex-end; }
            .auth-card { padding: 30px; } .profile-card { padding: 25px; }
             .profile-header { flex-direction: column; align-items: center; text-align: center; }
             .profile-avatar { margin-right: 0; margin-bottom: 15px; }
             .modal-content { width: 90%; margin: 5% auto; padding: 20px;}
             .content { padding: 120px 15px 60px; }
              .nav-user-details { display: none; }
        }
        #forum-post-view {
            display: none;
            flex-grow: 1;
        }
         #forum-post-view h3 {
            font-size: 1.8em;
            color: #fff;
            margin-bottom: 15px;
             margin-top: 20px;
             border-bottom: 1px dashed var(--accent-color);
             padding-bottom: 10px;
         }
          #forum-post-view .post-meta {
             font-size: 0.9em;
             color: var(--text-secondary);
             margin-bottom: 30px;
             padding-bottom: 15px;
             border-bottom: 1px solid var(--nav-border);
          }
           #forum-post-view .post-content-full {
              line-height: 1.8;
              color: var(--text-primary);
              white-space: pre-wrap;
              font-size: 1.05em;
              word-wrap: break-word;
              background: rgba(0,0,0,0.1);
              padding: 15px 20px;
              border-radius: 5px;
              margin-top: 10px;
           }
            #forum-post-view .back-link {
                display: inline-flex;
                align-items: center;
                margin-bottom: 25px;
                color: var(--accent-color);
                text-decoration: none;
                font-weight: 500;
                font-size: 0.95em;
                transition: color 0.2s ease;
                cursor: pointer;
            }
             #forum-post-view .back-link:hover {
                 color: #fff;
                 text-decoration: underline;
             }
             #forum-post-view .back-link i {
                 margin-right: 6px;
             }

    </style>
</head>
<body>

    <div id="particles-js"></div>

    <div id="message-container"></div>

    <nav class="nav">
        <a href="#home" class="tab-link active" data-tab="home"><i class="fas fa-home"></i> Home</a>
        <a href="#hacks" class="tab-link" data-tab="hacks"><i class="fas fa-ghost"></i> Hacks</a>
        <a href="#cfg" class="tab-link" data-tab="cfg"><i class="fas fa-sliders"></i> CFG</a>
        <a href="#forum" class="tab-link" data-tab="forum"><i class="fas fa-comments"></i> Forum</a>
        <a href="#cabinet" class="tab-link" data-tab="cabinet"><i class="fas fa-user-circle"></i> Cabinet</a>

        <div id="nav-user-info" class="nav-user-details" style="display: none;">
            <i class="fas fa-user nav-user-icon"></i>
            <span id="nav-username" class="nav-username-text"></span>
            <span class="nav-userid-text">(ID: <span id="nav-userid"></span>)</span>
        </div>
    </nav>

    <div id="custom-scrollbar">
        <div id="scrollbar-track"><div id="scrollbar-thumb"></div></div>
    </div>

    <div class="content">

        <div id="home" class="tab-content active">
            <h1>ReqSNGLove</h1>
            <div class="sub">Community Hub & Resources</div>
            <div class="buttons">
                <a href="https://t.me/swe1hx_cheat" class="btn" target="_blank"><i class="fab fa-telegram"></i> Join Telegram</a>
                <a href="https://www.youtube.com/@everyonecheat" class="btn" target="_blank"><i class="fab fa-youtube"></i> Join YouTube</a>
            </div>
        </div>

        <div id="hacks" class="tab-content">
             <h1>CS2 Enhancements</h1>
             <p style="color: var(--text-secondary); margin-bottom: 30px;">Explore tools for CS2. Use responsibly.</p>
             <ul class="feature-list">
                <li>
                 <div class="item-info"><div class="item-title">Aimware [Cracked]</div><div class="item-desc">Community version (Valid until 17.04.2025)</div></div>
                 <a href="https://drive.google.com/file/d/1Hul3maQlhIjicsNwzPxLN7HdaL0Aca-a/view?usp=drive_link" class="btn" target="_blank"><i class="fas fa-download"></i> Download</a>
                </li>
                <li>
                 <div class="item-info"><div class="item-title">SharkHack [Free]</div><div class="item-desc">Official free release (Check link for updates)</div></div>
                 <a href="https://t.me/sharkcs2" class="btn" target="_blank"><i class="fas fa-external-link-alt"></i> Visit</a>
                </li>
             </ul>
        </div>

        <div id="cfg" class="tab-content">
             <h1>Configuration Hub</h1>
             <p style="color: var(--text-secondary); margin-bottom: 30px;">Find and share configurations.</p>
             <ul class="feature-list">
                <li>
                  <div class="item-info"><div class="item-title">SharkHack Configs</div><div class="item-desc">Access via the official Telegram bot.</div></div>
                  <a href="https://t.me/shcfgbot" class="btn" target="_blank"><i class="fab fa-telegram-plane"></i> Open Bot</a>
                </li>
                <li>
                  <div class="item-info"><div class="item-title">Nonagon & Aimware Configs</div><div class="item-desc">Join the community Discord.</div></div>
                  <a href="https://discord.gg/3SRyZh6cxv" class="btn" target="_blank"><i class="fab fa-discord"></i> Join Discord</a>
                </li>
             </ul>
        </div>

        <div id="forum" class="tab-content">
            <h1>Community Forum</h1>
            <div id="forum-content-wrapper">
                <div id="forum-categories">
                    <h3><i class="fas fa-list"></i> Categories</h3>
                    <div class="loading-indicator" id="categories-loading"><i class="fas fa-spinner"></i> Loading...</div>
                    <ul id="category-list">
                    </ul>
                </div>

        <div id="forum-main-area">
            <div class="forum-header" style="display: none;">
                 <h2 id="forum-view-title">Select a Category</h2>
                 <?php if (isLoggedIn()): ?>
                    <button id="add-post-button" class="btn"><i class="fas fa-plus"></i> Add Post</button>
                 <?php endif; ?>
            </div>

            <div id="forum-posts-list" style="display: none;"> 
                 <div class="loading-indicator" id="posts-loading"><i class="fas fa-spinner"></i></div>
                 <div id="posts-list-container">
                     <p style="color: var(--text-secondary); text-align: center; margin-top: 30px;" id="forum-prompt">Please select a category from the left.</p>
                 </div>
            </div>

            <div id="forum-post-view" style="display: none;">
                <div class="loading-indicator" id="post-view-loading"><i class="fas fa-spinner"></i></div>
                 <div id="post-view-content">
                 </div>
            </div>
        </div>
            </div>
        </div>

        <div id="cabinet" class="tab-content">
            <h1>User Area</h1>
            <div id="cabinet-content">
                <div id="user-info" class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar"><i class="fas fa-user"></i></div>
                        <div class="profile-name">
                            <h3 id="profile-username">Username</h3>
                            <p id="profile-email">email@example.com</p> 
                        </div>
                    </div>
                    <div class="profile-details">
                        <div class="detail-item"><strong>User ID:</strong> <span id="profile-userid">Loading...</span></div>
                        <div class="detail-item"><strong>Status:</strong> <span id="profile-status">Verified</span></div>
                        <div class="detail-item"><strong>Joined:</strong> <span id="profile-joined">Loading...</span></div>
                    </div>
                    <div class="profile-actions">
                        <button id="logout-button" class="btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
                    </div>
                </div>

                <div id="login-register-forms" class="auth-card">
                    <form id="login-form" class="auth-form active">
                        <h2>Welcome Back!</h2>
                        <div class="message-placeholder"></div>
                        <div class="input-group">
                            <input type="text" id="login_username" name="username" placeholder="Username" required>
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="input-group">
                            <input type="password" id="login_password" name="password" placeholder="Password" required>
                            <i class="fas fa-lock"></i>
                        </div>
                        <button type="submit">Login</button>
                        <div class="auth-toggle">
                            Don't have an account? <a href="#" data-form="register">Register here</a>
                        </div>
                    </form>

                    <form id="register-form" class="auth-form">
                        <h2>Create Account</h2>
                        <div class="message-placeholder"></div>
                        <div class="input-group">
                            <input type="text" id="new_username" name="new_username" placeholder="Choose Username" required>
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="input-group">
                            <input type="email" id="new_email" name="new_email" placeholder="Email Address" required>
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="input-group">
                            <input type="password" id="new_password" name="new_password" placeholder="Create Password (min 6 chars)" required minlength="6">
                            <i class="fas fa-lock"></i>
                        </div>
                        <button type="submit">Register</button>
                        <div class="auth-toggle">
                            Already have an account? <a href="#" data-form="login">Login here</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="#">Terms</a> <a href="#">Privacy</a> <a href="#">Disclaimer</a> <a href="#">Contact</a>
            </div>
            <a href="https://t.me/nonagonzone" class="bottom-btn" target="_blank"><i class="fas fa-star"></i> Check Out Nonagon</a>
            <p>&copy; <span id="current-year"></span> ReqSNGLove. All rights reserved. Educational purposes only.</p>
            <p>Design by <a href="https://waveclient.ru/body/" style="color: var(--accent-color); text-decoration: none;">Structure</a></p>
        </div>
    </footer>

    <div id="add-post-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" data-modal-id="add-post-modal">&times;</span>
            <h2>Create New Post</h2>
             <div class="message-placeholder"></div>
            <form id="add-post-form">
                <input type="hidden" name="category" id="modal-post-category">
                <div class="input-group">
                    <input type="text" id="modal-post-title" name="post_title" placeholder="Post Title" required>
                </div>
                <div class="input-group">
                    <textarea id="modal-post-content" name="post_content" placeholder="Write your post content here..." required></textarea>
                </div>
                <button type="submit" class="btn">Submit Post</button>
            </form>
        </div>
    </div>

    <div id="cookie-banner" style="display: none;">
      <p>This website uses cookies to enhance your experience. By continuing to browse, you agree to our use of cookies.</p>
      <div class="cookie-buttons">
        <button id="accept-cookies" class="btn">Accept</button>
        <button id="reject-cookies" class="btn">Reject</button>
        <a href="/privacy-policy" target="_blank">Learn More</a>
      </div>
    </div>

    <script>
    function setCookie(name, value, days) {
        let expires = "";
        if (days) {
            let date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
    }
    function getCookie(name) {
        let nameEQ = name + "=";
        let ca = document.cookie.split(';');
        for(let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
    }
    function eraseCookie(name) {
        document.cookie = name+'=; Max-Age=-99999999; path=/; SameSite=Lax';
    }
    function sanitizeHTML(str) {
         if (str === null || typeof str === 'undefined') {
             return '';
         }
         const temp = document.createElement('div');
         temp.textContent = String(str); 
         return temp.innerHTML;
    }

    const API_ENDPOINT = 'https://waveclient.ru/test/api.php'; 
    let currentUser = null;
    let currentForumCategory = null; 
    let currentForumPostId = null; 

    const messageContainer = document.getElementById('message-container');
    const mainTabs = document.querySelectorAll('.tab-content');
    const mainLinks = document.querySelectorAll('.nav .tab-link');

    
    const navUserInfoContainer = document.getElementById('nav-user-info'); 
    const navUsernameSpan = document.getElementById('nav-username');     
    const navUserIdSpan = document.getElementById('nav-userid');         
    const forumTab = document.getElementById('forum');
    const forumContentWrapper = document.getElementById('forum-content-wrapper');
    const categoryListContainer = document.getElementById('category-list');
    const postsListContainerElement = document.getElementById('posts-list-container');
    const postViewContainer = document.getElementById('forum-post-view');
    const postViewContent = document.getElementById('post-view-content');
    const forumHeader = document.querySelector('#forum-main-area .forum-header');
    const forumViewTitle = document.getElementById('forum-view-title');
    const addPostButton = document.getElementById('add-post-button');
    const forumPrompt = document.getElementById('forum-prompt');

    const categoriesLoading = document.getElementById('categories-loading');
    const postsLoading = document.getElementById('posts-loading');
    const postViewLoading = document.getElementById('post-view-loading');
    const cabinetTab = document.getElementById('cabinet');
    const userInfoDiv = document.getElementById('user-info');
    const loginRegisterFormsDiv = document.getElementById('login-register-forms');
    const profileUsername = document.getElementById('profile-username');
    const profileEmail = document.getElementById('profile-email');
    const profileStatus = document.getElementById('profile-status');
    const profileJoined = document.getElementById('profile-joined');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const logoutButton = document.getElementById('logout-button');
    const addPostModal = document.getElementById('add-post-modal');
    const addPostForm = document.getElementById('add-post-form');
    const modalPostCategoryInput = document.getElementById('modal-post-category');
    const modalCloseButtons = document.querySelectorAll('.modal-close');
    const currentYearSpan = document.getElementById('current-year');
    const cookieBanner = document.getElementById('cookie-banner');
    const acceptCookiesButton = document.getElementById('accept-cookies');
    const rejectCookiesButton = document.getElementById('reject-cookies');
    const scrollbarThumb = document.getElementById('scrollbar-thumb');
    const scrollbarTrack = document.getElementById('scrollbar-track');


        async function apiRequest(action, params = {}, method = 'GET') {
            const url = new URL(API_ENDPOINT, window.location.origin);
            url.searchParams.append('action', action);

            let options = {
                method: method,
                headers: {}
            };

             if (method === 'GET') {
                 for (const key in params) {
                    if (params.hasOwnProperty(key) && params[key] !== undefined && params[key] !== null) {
                        url.searchParams.append(key, params[key]);
                    }
                 }
             } else {
                const formData = new FormData();
                for (const key in params) {
                     if (params.hasOwnProperty(key) && params[key] !== undefined && params[key] !== null) {
                        formData.append(key, params[key]);
                    }
                }
                options.body = formData;
             }

            console.log(`API Request: ${method} ${url.toString()}`, method === 'POST' ? Object.fromEntries(options.body.entries()) : '');

            try {
                const response = await fetch(url.toString(), options);
                console.log(`API Response Status (${action}): ${response.status} ${response.statusText}`);

                 let responseData = {};
                 const contentType = response.headers.get("content-type");

                 if (response.status === 204) {
                    responseData = { success: true, message: 'Action completed successfully.' };
                 } else if (contentType && contentType.includes("application/json")) {
                    const rawText = await response.text();
                    try {
                        responseData = JSON.parse(rawText);
                    } catch (e) {
                         console.error(`API JSON Parse Error (${action}):`, e, "Raw Response:", rawText.substring(0, 500));
                 
                         const match = rawText.match(/<p>(.*?)<\/p>/i);
                         const htmlError = match ? match[1] : 'Invalid JSON response from server.';
                         responseData.success = false;
                         responseData.message = htmlError;
                    }
                 } else {
                      const textResponse = await response.text();
                      console.error(`API Non-JSON Response (${action}):`, textResponse.substring(0, 500));
                      const match = textResponse.match(/<p>(.*?)<\/p>/i);
                      const htmlError = match ? match[1] : `Server returned non-JSON response (Status: ${response.status}). Check PHP logs.`;
                      responseData.success = false;
                      responseData.message = htmlError;
                 }

                if (!response.ok) {
                    const errorMessage = responseData?.message || `Request failed with status ${response.status}`;
                     console.error(`API Error Response Body (${action}):`, responseData);
                    throw new Error(errorMessage);
                }

                if (responseData && responseData.success === false) {
                     console.warn(`API Indicated Failure (${action}): ${responseData.message || 'Unknown reason.'}`, responseData);
                     throw new Error(responseData.message || 'API request indicated failure.');
                }

                console.log(`API Success Response (${action}):`, responseData);
                if (typeof responseData.success === 'undefined') responseData.success = true;
                return responseData;

            } catch (error) {
                console.error(`Fetch/Network Error (${action}):`, error);
                 
                 throw error;
            }
        }



    function showLoading(indicatorElement, text = 'Loading...') {
        if (indicatorElement) {
            indicatorElement.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${sanitizeHTML(text)}`;
            indicatorElement.style.display = 'block'; 
            indicatorElement.classList.add('show');
        }
    }
    function hideLoading(indicatorElement) {
        if (indicatorElement) {
            indicatorElement.style.display = 'none';
            indicatorElement.classList.remove('show');
        }
    }

    function displayMessage(type, text, duration = 5000) {
         if (!messageContainer || !text) return;
         console.log(`Displaying Message (${type}): ${text}`);
         const messageDiv = document.createElement('div');
         messageDiv.className = `message ${type}`;
         messageDiv.textContent = text; 

         messageContainer.appendChild(messageDiv);
         void messageDiv.offsetWidth;
         messageDiv.classList.add('show');

         setTimeout(() => {
             messageDiv.classList.remove('show');
             messageDiv.addEventListener('transitionend', () => messageDiv.remove(), { once: true });
         }, duration);
    }

    function displayFormError(formElement, text) {
        if (!formElement) return;
        const placeholder = formElement.querySelector('.message-placeholder');
        const safeText = text || 'An unknown error occurred.';
        if (placeholder) {
            placeholder.innerHTML = `<div class="message error show">${sanitizeHTML(safeText)}</div>`;
        } else {
        }
    }
    function clearFormError(formElement) {
         if (!formElement) return;
        const placeholder = formElement.querySelector('.message-placeholder');
        if (placeholder) {
            placeholder.innerHTML = '';
        }
    }

    function disableForm(formElement, disabled) {
        if (!formElement) return;
         const elements = formElement.querySelectorAll('input, textarea, button');
         elements.forEach(el => { el.disabled = disabled; });
         const submitButton = formElement.querySelector('button[type="submit"]');
         if (submitButton) {
             if (disabled) {
                 if (!submitButton.dataset.originalText) {
                     submitButton.dataset.originalText = submitButton.innerHTML;
                 }
                 submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
             } else {
                 submitButton.innerHTML = submitButton.dataset.originalText || 'Submit';
             }
         }
    }
    function updateAuthUI() {
        console.log("Updating Auth UI. Current User object:", currentUser);

        const isLoggedIn = !!(currentUser && currentUser.userId);

        const userInfoDiv = document.getElementById('user-info');
        const loginRegisterFormsDiv = document.getElementById('login-register-forms');
        const addPostButton = document.getElementById('add-post-button');
        const navUserInfoContainer = document.getElementById('nav-user-info');
        const navUsernameSpan = document.getElementById('nav-username');
        const navUserIdSpan = document.getElementById('nav-userid');
        const profileUsername = document.getElementById('profile-username');
        const profileEmail = document.getElementById('profile-email');
        const profileUserId = document.getElementById('profile-userid');
        const profileStatus = document.getElementById('profile-status');
        const profileJoined = document.getElementById('profile-joined');


        if (isLoggedIn) {
            console.log("User is logged in. Updating profile and nav.");
            if (profileUsername) {
                profileUsername.textContent = sanitizeHTML(currentUser.username || 'N/A');
            } else { console.warn("Element #profile-username not found"); }

            if (profileEmail) {
                profileEmail.textContent = sanitizeHTML(currentUser.email || 'Not Provided');
            } else { console.warn("Element #profile-email not found"); }

            if (profileUserId) {
                 profileUserId.textContent = sanitizeHTML(currentUser.userId ? currentUser.userId : 'N/A');
             } else { console.warn("Element #profile-userid not found"); }

            if (profileStatus) {
                profileStatus.textContent = sanitizeHTML(currentUser.status || 'Standard');
            } else { console.warn("Element #profile-status not found"); }

            if (profileJoined) {
                if (currentUser.joined && currentUser.joined > 0) {
                     try {
                         const joinedDate = new Date(currentUser.joined * 1000);
                         profileJoined.textContent = joinedDate.toLocaleDateString('en-US', {
                             year: 'numeric', month: 'short', day: 'numeric'
                         });
                     } catch(e) {
                         console.error("Error formatting joined date:", e);
                         profileJoined.textContent = 'Invalid Date';
                     }
                 } else {
                     profileJoined.textContent = 'Unknown';
                 }
            } else { console.warn("Element #profile-joined not found"); }

            if(userInfoDiv) userInfoDiv.classList.add('active');
            if(loginRegisterFormsDiv) loginRegisterFormsDiv.classList.remove('active');

            if (navUserInfoContainer) {
                if (navUsernameSpan) {
                    navUsernameSpan.textContent = sanitizeHTML(currentUser.username || 'User');
                } else { console.warn("Element #nav-username not found"); }

                if (navUserIdSpan) {
                    navUserIdSpan.textContent = sanitizeHTML(currentUser.userId ? currentUser.userId : 'N/A');
                } else { console.warn("Element #nav-userid not found"); }

                navUserInfoContainer.style.display = 'flex'; 
            } else { console.warn("Element #nav-user-info not found"); }


            if(addPostButton) addPostButton.style.display = 'inline-flex';

        } else {
            console.log("User is not logged in. Updating UI accordingly.");
             if(userInfoDiv) userInfoDiv.classList.remove('active');
             if(loginRegisterFormsDiv) loginRegisterFormsDiv.classList.add('active');
             if(loginForm) loginForm.classList.add('active');
             if(registerForm) registerForm.classList.remove('active');

             if (navUserInfoContainer) {
                 navUserInfoContainer.style.display = 'none';
             }

             if(addPostButton) addPostButton.style.display = 'none';
        }
         clearFormError(loginForm);
         clearFormError(registerForm);
    }

    async function checkAuthentication() {
        console.log("Checking authentication status...");
        try {
            const response = await apiRequest('check_auth', {}, 'GET');
            console.log("check_auth response data:", response.data);

            if (response.success && response.data && response.data.userId) {
                currentUser = response.data; 
                console.log('User authenticated:', currentUser);
            } else {
                currentUser = null;
                console.log('User not authenticated (API check).');
            }
        } catch (error) {
             console.warn('Auth check request failed:', error.message);
            currentUser = null;
        }
         console.log("Calling updateAuthUI after checkAuthentication...");
         updateAuthUI(); 
    }

    function resetForumView(showPrompt = true) {
         console.log(`Resetting forum view. Show prompt: ${showPrompt}`);
         if(postsListContainerElement) postsListContainerElement.innerHTML = '';
         if(postViewContainer) postViewContainer.style.display = 'none';
         if(forumPrompt) forumPrompt.style.display = showPrompt ? 'block' : 'none';
         if(forumHeader) forumHeader.style.display = 'none';
         currentForumCategory = null;
         currentForumPostId = null;
         document.querySelectorAll('#category-list .active-category').forEach(el => el.classList.remove('active-category'));
         hideLoading(postsLoading);
         hideLoading(postViewLoading);
         const postsListParent = document.getElementById('forum-posts-list');
         if(postsListParent) postsListParent.style.display = 'block'; 
    }

    async function loadCategories() {
        showLoading(categoriesLoading, 'Loading Categories...');
        if(categoryListContainer) categoryListContainer.innerHTML = '';
        try {
            const response = await apiRequest('get_categories', {}, 'GET');
            if (!response.success || typeof response.data !== 'object' || response.data === null || Object.keys(response.data).length === 0) {
                 if(categoryListContainer) categoryListContainer.innerHTML = '<li>No categories found.</li>';
                 console.warn('No categories found or invalid data received.');
            } else {
                const categories = response.data;
                if(categoryListContainer){
                     for (const slug in categories) {
                        if (Object.hasOwnProperty.call(categories, slug)) {
                            const li = document.createElement('li');
                            const a = document.createElement('a');
                            a.href = `#forum/${slug}`;
                            a.dataset.categorySlug = slug;
                            a.classList.add('forum-category-link');
                            a.textContent = sanitizeHTML(categories[slug]);
                            li.appendChild(a);
                            categoryListContainer.appendChild(li);
                        }
                     }
                }
            }
        } catch (error) {
             if(categoryListContainer) categoryListContainer.innerHTML = '<li>Error loading categories.</li>';
        } finally {
            hideLoading(categoriesLoading);
        }
    }

    async function loadPosts(categorySlug, categoryName) {
         if (!categorySlug) {
             console.error("loadPosts called without categorySlug");
             resetForumView(); return;
         }
        resetForumView(false);
        currentForumCategory = categorySlug;
        currentForumPostId = null;
        showLoading(postsLoading, 'Loading Posts...');
        if(postsListContainerElement) postsListContainerElement.innerHTML = '';
        if(postViewContainer) postViewContainer.style.display = 'none';
        if(forumHeader) forumHeader.style.display = 'flex';
        if(forumViewTitle) forumViewTitle.textContent = sanitizeHTML(categoryName || categorySlug);

         document.querySelectorAll('.forum-category-link').forEach(link => {
             link.classList.toggle('active-category', link.dataset.categorySlug === categorySlug);
         });
         if (addPostButton) {
             addPostButton.style.display = currentUser ? 'inline-flex' : 'none';
         }

        try {
            const response = await apiRequest('get_posts', { category: categorySlug }, 'GET');
            const posts = response.data || [];

            if (posts.length === 0) {
                if(postsListContainerElement) postsListContainerElement.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No posts in this category yet.</p>';
            } else {
                const ul = document.createElement('ul');
                posts.forEach(post => {
                    if (typeof post !== 'object' || !post.id || !post.title) {
                         console.warn('Skipping invalid post data item:', post); return;
                     }
                    const li = document.createElement('li');
                    li.dataset.postId = post.id;

                    const postInfoDiv = document.createElement('div');
                    postInfoDiv.className = 'post-info';

                    const titleDiv = document.createElement('div');
                    titleDiv.className = 'post-title';
                    const titleLink = document.createElement('a');
                    titleLink.href = `#forum/${categorySlug}/${post.id}`;
                    titleLink.dataset.postId = post.id;
                    titleLink.dataset.categorySlug = categorySlug;
                    titleLink.classList.add('forum-post-link');
                    titleLink.textContent = sanitizeHTML(post.title);

                    const metaDiv = document.createElement('div');
                    metaDiv.className = 'post-meta';
                    const postDate = post.timestamp ? new Date(post.timestamp * 1000).toLocaleString() : 'Unknown date';
                    metaDiv.textContent = `by ${sanitizeHTML(post.username || 'Unknown User')} on ${postDate}`;

                    titleDiv.appendChild(titleLink);
                    postInfoDiv.appendChild(titleDiv);
                    postInfoDiv.appendChild(metaDiv);
                    li.appendChild(postInfoDiv);

                    if (currentUser && post.user_id && post.user_id == currentUser.userId) {
                         const actionsDiv = document.createElement('div');
                         actionsDiv.className = 'post-actions';
                         const deleteButton = document.createElement('button');
                         deleteButton.type = 'button';
                         deleteButton.className = 'delete-post-button';
                         deleteButton.dataset.postId = post.id;
                         deleteButton.dataset.categorySlug = categorySlug;
                         deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
                         deleteButton.title = 'Delete Post';
                         actionsDiv.appendChild(deleteButton);
                         li.appendChild(actionsDiv);
                    }
                    ul.appendChild(li);
                });
                 if(postsListContainerElement) postsListContainerElement.appendChild(ul);
            }
             const postsListParent = document.getElementById('forum-posts-list');
             if(postsListParent) postsListParent.style.display = 'block';
        } catch (error) {
             if(postsListContainerElement) postsListContainerElement.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Error loading posts.</p>';
        } finally {
            hideLoading(postsLoading);
        }
    }

async function loadSinglePost(postId, categorySlug, categoryName) {
     if (!postId || !categorySlug) {
         console.error("loadSinglePost called without postId or categorySlug");
         resetForumView(); return;
     }
     resetForumView(false);
     currentForumPostId = postId;
     showLoading(postViewLoading, 'Loading Post...');
     if(postsListContainerElement && postsListContainerElement.parentElement) {  
        postsListContainerElement.parentElement.style.display = 'none'; 
     }

     if(postViewContainer) postViewContainer.style.display = 'block';
     if (addPostButton) addPostButton.style.display = 'none';
     if(forumViewTitle) forumViewTitle.textContent = sanitizeHTML(categoryName || categorySlug);

     try {
         const response = await apiRequest('get_post', { category: categorySlug, id: postId }, 'GET');
         const post = response.data;

         if (!post || typeof post !== 'object' || !post.id) {
              throw new Error('Invalid post data received from server.');
         }

         const postDate = post.timestamp ? new Date(post.timestamp * 1000).toLocaleString() : 'Unknown date';
         if(postViewContent) {
            const backLinkHTML = `<a href="#forum/${sanitizeHTML(categorySlug)}" class="back-link" data-category-slug="${sanitizeHTML(categorySlug)}" data-category-name="${sanitizeHTML(categoryName || categorySlug)}"><i class="fas fa-arrow-left"></i> Back to ${sanitizeHTML(categoryName || categorySlug)}</a>`;
            const titleHTML = `<h3>${sanitizeHTML(post.title)}</h3>`;
            const metaHTML = `<div class="post-meta">Posted by ${sanitizeHTML(post.username)} on ${postDate}</div>`;
            const contentHTML = `<div class="post-content-full">${sanitizeHTML(post.content).replace(/\n/g, '<br>')}</div>`;
            postViewContent.innerHTML = backLinkHTML + titleHTML + metaHTML + contentHTML;
         }

     } catch (error) {
         if(postViewContent){
             postViewContent.innerHTML = `
                 <p style="color: var(--text-secondary);">Error loading post details.</p>
                 <a href="#forum/${sanitizeHTML(categorySlug)}" class="back-link" data-category-slug="${sanitizeHTML(categorySlug)}" data-category-name="${sanitizeHTML(categoryName || categorySlug)}">
                   <i class="fas fa-arrow-left"></i> Back
                 </a>`;
         }
     } finally {
         hideLoading(postViewLoading);
     }
 }

    async function deletePost(postId, categorySlug) {
        if (!currentUser) {
            return;
        }
        if (!confirm('Are you sure you want to delete this post? This cannot be undone.')) {
            return;
        }

        const postListItem = postsListContainerElement?.querySelector(`li[data-post-id="${postId}"]`);
        if (postListItem) postListItem.style.opacity = '0.5';

        try {
            const response = await apiRequest('delete_post', { id: postId, category: categorySlug }, 'POST');
           
           
             if (postListItem) {
                 postListItem.style.transition = 'opacity 0.3s ease, transform 0.3s ease, height 0.3s ease, margin 0.3s ease, padding 0.3s ease';
                 postListItem.style.opacity = '0';
                 postListItem.style.transform = 'scale(0.95)';
                 postListItem.style.height = '0';
                 postListItem.style.marginTop = '0'; 
                 postListItem.style.marginBottom = '0';
                 postListItem.style.paddingTop = '0';
                 postListItem.style.paddingBottom = '0';
                 postListItem.addEventListener('transitionend', () => {
                     if (postListItem.parentNode) postListItem.remove();
                 }, { once: true });
                 setTimeout(() => {
                      if (postListItem.parentNode) postListItem.remove();
                 }, 350);
             } else {
                  console.warn("Deleted post item not found in DOM for removal, reloading list.");
                  const categoryName = forumViewTitle?.textContent || categorySlug;
                  loadPosts(categorySlug, categoryName);
             }
        } catch (error) {
            if (postListItem) postListItem.style.opacity = '1';
        }
    }
    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
             modal.style.display = 'flex'; 
             requestAnimationFrame(() => {
                modal.classList.add('show');
                modal.classList.remove('hide');
             });
             const firstInput = modal.querySelector('input:not([type=hidden]), textarea');
             if (firstInput) {
                 setTimeout(() => firstInput.focus(), 50);
             }
        }
    }

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal && modal.classList.contains('show')) {
             modal.classList.add('hide');
             modal.classList.remove('show');
             modal.addEventListener('animationend', () => {
                 if (modal.classList.contains('hide')) {
                    modal.classList.remove('hide');
                    modal.style.display = 'none';
                 }
             }, { once: true });
             setTimeout(() => {
                 if (modal.classList.contains('hide')) {
                    modal.classList.remove('hide');
                    modal.style.display = 'none';
                 }
             }, 400);
        }
    }

    document.addEventListener('DOMContentLoaded', async () => {
        console.log("DOM Loaded. Initializing...");

        if(currentYearSpan) currentYearSpan.textContent = new Date().getFullYear();

        if (typeof particlesJS === 'function') { 
             console.log('Initializing Particles.js');
             try {
                particlesJS("particles-js", {particles:{number:{value:60,density:{enable:!0,value_area:800}},color:{value:"#ffffff"},shape:{type:"circle",stroke:{width:0,color:"#000000"},polygon:{nb_sides:5},image:{src:"img/github.svg",width:100,height:100}},opacity:{value:.5,random:!1,anim:{enable:!1,speed:1,opacity_min:.1,sync:!1}},size:{value:3,random:!0,anim:{enable:!1,speed:40,size_min:.1,sync:!1}},line_linked:{enable:!0,distance:150,color:"#ffffff",opacity:.4,width:1},move:{enable:!0,speed:2,direction:"none",random:!1,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},interactivity:{detect_on:"canvas",events:{onhover:{enable:!0,mode:"grab"},onclick:{enable:!0,mode:"push"},resize:!0},modes:{grab:{distance:140,line_linked:{opacity:1}},bubble:{distance:400,size:40,duration:2,opacity:8,speed:3},repulse:{distance:200,duration:.4},push:{particles_nb:4},remove:{particles_nb:2}}},retina_detect:!0});
             } catch(e) {
                 console.error("Particles.js initialization failed:", e);
             }
        } else {
             console.warn('particlesJS library not loaded or not a function.');
        }

        await checkAuthentication();

        mainLinks.forEach(link => {
            link.addEventListener('click', e => {
                 if (e.defaultPrevented) return;
                 e.preventDefault();

                 const targetTabId = link.getAttribute('data-tab');
                 if (!targetTabId || link.classList.contains('active')) return;

                 window.location.hash = targetTabId;
            });
        });

         function handleHashChange() {
            let hash = window.location.hash.substring(1);
             console.log("Handling hash:", hash);

             let targetTabId = 'home';
             let forumCategorySlug = null;
             let forumPostId = null;

             if (hash.startsWith('forum')) {
                 targetTabId = 'forum';
                 const parts = hash.split('/');
                 if (parts.length >= 2 && parts[1]) forumCategorySlug = parts[1];
                 if (parts.length >= 3 && parts[2]) forumPostId = parts[2];
             } else if (hash) {
                  const potentialTabLink = document.querySelector(`.nav a[data-tab="${hash}"]`);
                  if (potentialTabLink) {
                      targetTabId = hash;
                  } else {
                      console.warn(`Invalid tab hash "${hash}", defaulting to home.`);
                       window.location.hash = 'home';
                       return;
                  }
             }

             let activeLinkFound = false;
             mainLinks.forEach(link => {
                 const isActive = link.getAttribute('data-tab') === targetTabId;
                 link.classList.toggle('active', isActive);
                 if (isActive) activeLinkFound = true;
             });
             if (!activeLinkFound && mainLinks.length > 0) {
                  mainLinks[0].classList.add('active');
                   if(mainTabs[0]) mainTabs[0].classList.add('active');
             }


             mainTabs.forEach(t => {
                 t.classList.toggle('active', t.id === targetTabId);
             });


             if (targetTabId === 'forum') {
                 console.log("Processing Forum Tab activation/navigation...");
                 if (!categoryListContainer || categoryListContainer.children.length <= 1 || categoriesLoading.style.display === 'block') {
                      console.log("Loading categories needed for forum...");
                      loadCategories().then(() => {
                          if (forumPostId && forumCategorySlug) {
                              const catLink = categoryListContainer?.querySelector(`a[data-category-slug="${forumCategorySlug}"]`);
                              const catName = catLink ? catLink.textContent : forumCategorySlug;
                              loadSinglePost(forumPostId, forumCategorySlug, catName);
                          } else if (forumCategorySlug) {
                               const catLink = categoryListContainer?.querySelector(`a[data-category-slug="${forumCategorySlug}"]`);
                               const catName = catLink ? catLink.textContent : forumCategorySlug;
                               loadPosts(forumCategorySlug, catName);
                          } else {
                               resetForumView(); 
                          }
                      });
                 } else {
                      if (forumPostId && forumCategorySlug) {
                          const catLink = categoryListContainer?.querySelector(`a[data-category-slug="${forumCategorySlug}"]`);
                          const catName = catLink ? catLink.textContent : forumCategorySlug;
                          loadSinglePost(forumPostId, forumCategorySlug, catName);
                      } else if (forumCategorySlug) {
                           const catLink = categoryListContainer?.querySelector(`a[data-category-slug="${forumCategorySlug}"]`);
                           const catName = catLink ? catLink.textContent : forumCategorySlug;
                           loadPosts(forumCategorySlug, catName);
                      } else {
                            resetForumView(); 
                      }
                 }
             } else if (targetTabId === 'cabinet') {
                  console.log("Processing Cabinet Tab activation...");
                 updateAuthUI();
             } else {
                  console.log(`Processing activation for tab: ${targetTabId}`);
             }

              updateScrollThumbPosition();
        }
        window.addEventListener('hashchange', handleHashChange);
        handleHashChange();

        if (categoryListContainer) {
            categoryListContainer.addEventListener('click', (e) => {
                const link = e.target.closest('a.forum-category-link');
                if (link) {
                    e.preventDefault(); 
                    const categorySlug = link.dataset.categorySlug;
                    if (categorySlug) window.location.hash = `forum/${categorySlug}`;
                }
            });
        }

        const postsListArea = document.getElementById('forum-posts-list');
        if (postsListArea) {
             postsListArea.addEventListener('click', (e) => {
                const postLink = e.target.closest('a.forum-post-link');
                const deleteButton = e.target.closest('button.delete-post-button');

                if (postLink) {
                    e.preventDefault();
                    const postId = postLink.dataset.postId;
                    const categorySlug = postLink.dataset.categorySlug;
                    if (postId && categorySlug) {
                        window.location.hash = `forum/${categorySlug}/${postId}`;
                    }
                } else if (deleteButton) {
                    e.preventDefault();
                    const postId = deleteButton.dataset.postId;
                    const categorySlug = deleteButton.dataset.categorySlug;
                    if (postId && categorySlug) {
                        deletePost(postId, categorySlug);
                    }
                }
             });
        }

        if (postViewContainer) {
            postViewContainer.addEventListener('click', (e) => {
                const backLink = e.target.closest('a.back-link');
                if (backLink) {
                    e.preventDefault();
                    const categorySlug = backLink.dataset.categorySlug;
                    if (categorySlug) {
                        window.location.hash = `forum/${categorySlug}`;
                    } else {
                        window.location.hash = 'forum';
                    }
                }
            });
        }

        if (addPostButton) {
             addPostButton.addEventListener('click', () => {
                if (currentForumCategory && currentUser) {
                    openModal('add-post-modal');
                    if (modalPostCategoryInput) modalPostCategoryInput.value = currentForumCategory;
                    if (addPostForm) addPostForm.reset();
                    clearFormError(addPostForm);
                } else if (!currentUser) {
                     
                     
                } else {
                   
                   
                }
             });
         }


        if (loginForm) {
            const loginSubmitButton = loginForm.querySelector('button[type="submit"]');
            if (loginSubmitButton) loginSubmitButton.dataset.originalText = loginSubmitButton.innerHTML;
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearFormError(loginForm); disableForm(loginForm, true);
                try {
                    const response = await apiRequest('login', { username: loginForm.username.value, password: loginForm.password.value }, 'POST');
                    currentUser = response.data; updateAuthUI();
                     if (forumTab?.classList.contains('active')) { resetForumView(); } 
                } catch (error) { displayFormError(loginForm, error.message || 'Invalid username or password.'); }
                finally { disableForm(loginForm, false); }
            });
         }
         if (registerForm) {
             const regSubmitButton = registerForm.querySelector('button[type="submit"]');
             if (regSubmitButton) regSubmitButton.dataset.originalText = regSubmitButton.innerHTML;
             registerForm.addEventListener('submit', async (e) => {
                 e.preventDefault(); clearFormError(registerForm); disableForm(registerForm, true);
                 try {
                     const response = await apiRequest('register', { new_username: registerForm.new_username.value, new_email: registerForm.new_email.value, new_password: registerForm.new_password.value }, 'POST');
                     const forms = loginRegisterFormsDiv?.querySelectorAll('.auth-form');
                     forms?.forEach(form => form.classList.toggle('active', form.id === 'login-form'));
                     registerForm.reset();
                 } catch (error) { displayFormError(registerForm, error.message); }
                 finally { disableForm(registerForm, false); }
             });
         }
         if (logoutButton) {
            logoutButton.addEventListener('click', async (e) => {
                e.preventDefault(); logoutButton.disabled = true; logoutButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging out...';
                try {
                    await apiRequest('logout', {}, 'POST');
                } catch (error) { }
                finally {
                    currentUser = null; updateAuthUI(); logoutButton.disabled = false; logoutButton.innerHTML = '<i class="fas fa-sign-out-alt"></i> Logout';
                    if (forumTab?.classList.contains('active')) { resetForumView(); }
                }
            });
         }
          const authCard = document.getElementById('login-register-forms');
          if (authCard) {
              authCard.addEventListener('click', (e) => {
                   const toggleLink = e.target.closest('.auth-toggle a');
                   if (toggleLink) {
                       e.preventDefault();
                       const targetFormId = toggleLink.getAttribute('data-form');
                       const forms = authCard.querySelectorAll('.auth-form');
                       forms.forEach(form => {
                           form.classList.toggle('active', form.id === `${targetFormId}-form`);
                       });
                       clearFormError(loginForm); clearFormError(registerForm);
                   }
              });
          }


        if (addPostForm) {
            const postSubmitButton = addPostForm.querySelector('button[type="submit"]');
            if (postSubmitButton) postSubmitButton.dataset.originalText = postSubmitButton.innerHTML;
            addPostForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearFormError(addPostForm); disableForm(addPostForm, true);
                try {
                    const response = await apiRequest('create_post', { category: addPostForm.category.value, post_title: addPostForm.post_title.value, post_content: addPostForm.post_content.value }, 'POST');
                    closeModal('add-post-modal');
                    if (currentForumCategory) {
                        const categoryName = document.querySelector(`#category-list a[data-category-slug="${currentForumCategory}"]`)?.textContent || currentForumCategory;
                        loadPosts(currentForumCategory, categoryName);
                    }
                } catch (error) { displayFormError(addPostForm, error.message); }
                finally { disableForm(addPostForm, false); }
            });
        }
        modalCloseButtons.forEach(button => {
            button.addEventListener('click', () => { if (button.dataset.modalId) closeModal(button.dataset.modalId); });
        });
        window.addEventListener('click', (event) => {
            if (event.target.classList.contains('modal') && event.target.classList.contains('show')) { closeModal(event.target.id); }
        });
         document.addEventListener('keydown', (event) => {
             if (event.key === 'Escape') { const openModal = document.querySelector('.modal.show'); if (openModal) { closeModal(openModal.id); } }
         });


        function handleCookieConsent() {}
        if (acceptCookiesButton && cookieBanner) {}
        if (rejectCookiesButton && cookieBanner) {}
        handleCookieConsent();


        function updateScrollThumbPosition() {
             if (!scrollbarThumb || !scrollbarTrack) return;
             const trackRect = scrollbarTrack.getBoundingClientRect();
             const windowHeight = document.documentElement.clientHeight;
             const documentHeight = document.documentElement.scrollHeight;
             if (documentHeight <= windowHeight || trackRect.height <= 0) {
                 scrollbarThumb.style.height = '0px'; scrollbarThumb.style.top = '0px'; return;
             }
             const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
             const scrollableDist = documentHeight - windowHeight;
             const thumbHeight = Math.max(20, trackRect.height * (windowHeight / documentHeight));
             const maxThumbPosition = trackRect.height - thumbHeight;
             const scrollPercentage = scrollableDist > 0 ? scrollPosition / scrollableDist : 0;
             const thumbPosition = Math.min(maxThumbPosition, Math.max(0, scrollPercentage * maxThumbPosition));
             scrollbarThumb.style.height = thumbHeight + 'px'; scrollbarThumb.style.top = thumbPosition + 'px';
         }
         function initializeScrollbar() {
            let isDragging = false; let startY = 0; let startScrollTop = 0;
            if (!scrollbarThumb || !scrollbarTrack) { console.warn('Scrollbar elements not found.'); return; }
            scrollbarThumb.addEventListener('mousedown', (e) => {
                isDragging = true; startY = e.clientY; startScrollTop = window.pageYOffset || document.documentElement.scrollTop;
                scrollbarThumb.style.background = '#007bff'; document.body.style.userSelect = 'none'; e.preventDefault();
            });
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                const trackRect = scrollbarTrack.getBoundingClientRect(); const thumbHeight = scrollbarThumb.offsetHeight;
                const windowHeight = document.documentElement.clientHeight; const documentHeight = document.documentElement.scrollHeight;
                if (documentHeight <= windowHeight || trackRect.height <= thumbHeight) return;
                const deltaY = e.clientY - startY; const scrollableDist = documentHeight - windowHeight;
                const trackScrollableDist = trackRect.height - thumbHeight; if (trackScrollableDist <= 0) return;
                const scrollAmountDelta = (deltaY / trackScrollableDist) * scrollableDist;
                const newScrollTop = Math.min(scrollableDist, Math.max(0, startScrollTop + scrollAmountDelta));
                window.scrollTo(0, newScrollTop);
            });
            document.addEventListener('mouseup', () => {
                if (isDragging) { isDragging = false; scrollbarThumb.style.background = 'rgba(0, 123, 255, 0.8)'; document.body.style.userSelect = ''; }
            });
             document.addEventListener('mouseleave', (e) => {
                 if (isDragging && (e.clientY <= 0 || e.clientX <= 0 || e.clientX >= window.innerWidth || e.clientY >= window.innerHeight)) {
                    isDragging = false; scrollbarThumb.style.background = 'rgba(0, 123, 255, 0.8)'; document.body.style.userSelect = '';
                 }
             });
            window.addEventListener('scroll', updateScrollThumbPosition, { passive: true }); window.addEventListener('resize', updateScrollThumbPosition);
            updateScrollThumbPosition(); console.log('Scrollbar initialized.');
         }
         initializeScrollbar();


        console.log("Initialization complete.");

    });
</script>
</body>
</html>